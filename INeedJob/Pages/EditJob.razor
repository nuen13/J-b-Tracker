@using JobTrackerApp.Services
@using JobTrackerApp.Models

@page "/edit-job/{id:guid}"

@inject JobApplicationService JobService
@inject NavigationManager Navigation


<h2> Edit Job Application </h2>

@if (job == null)
{
    <p>Loading job infomation ... </p>
}
else{
    <div class = "form-container">
        <EditForm Model = "@job" OnValidSubmit="HandleValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary /> 

            <div class="form-group">
                <label>Position</label>
                <input class="form-control" @bind="job.Position" />
            </div>

            <div class="form-group">
                <label>Company</label>
                <input class="form-control" @bind="job.Company" />
            </div>

            <div class="form-group">
                <label>Industry</label>
                <input class="form-control" @bind="job.Industry" />
            </div>

            <div class="form-group">
                <label>Role</label>
                <input class="form-control" @bind="job.Role" />
            </div>

            <div class="form-group">
                <label>Location</label>
                <input class="form-control" @bind="job.Location" />
            </div>

            <div class="form-group">
                <label>Date Posted</label>
                <input type="date" class="form-control" @bind="job.DatePosted" />
            </div>

            <div class="form-group">
                <label>Date Applied</label>
                <input type="date" class="form-control" @bind="job.DateApplied" />
            </div>

            <div class="form-group">
                <label>Connections</label>
                <input class="form-control" @bind="job.Connections" />
            </div>

            <div class="form-group">
                <label>Cover Letter</label>
                <input type="checkbox" @bind="job.HasCoverLetter" />
            </div>

            <div class="form-group">
                <label>Résumé Form</label>
                <input type="checkbox" @bind="job.HasResumeForm" />
            </div>

            <div class="form-group">
                <label>Salary Range</label>
                <input class="form-control" @bind="job.SalaryRange" />
            </div>

            <div class="form-group">
                <label>Notes</label>
                <textarea class="form-control" @bind="job.Notes"></textarea>
            </div>

            <div class="form-group">
                <label>Applied LInk</label>
                <textarea class="form-control" @bind="job.AppliedLink"></textarea>
            </div>

            <div class="form-group">
                <label>Status</label>
                <select class="form-control" @bind="job.Status">
                    @foreach (var value in Enum.GetValues<ApplicationStatus>())
                    {
                        <option value="@value">@value</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <label>Latest Contact Name</label>
                <input class="form-control" @bind="job.LatestContactName" />
            </div>

            <button class="submit-btn">Save Changes</button>
        </EditForm>
    </div>
}


@code {
    [Parameter]
    public Guid id { get; set; }

    JobApplication? job;

    protected override async Task OnInitializedAsync()
    {
        job = await JobService.GetByIdAsync(id);
    }

    private async Task HandleValidSubmit()
    {
        await JobService.UpdateAsync(job);
        Navigation.NavigateTo("/");
    }
}
